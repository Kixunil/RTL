<div fxLayout="column" fxFlex="100" fxLayoutAlign="start stretch" *ngIf="!flgShowInfo" [@showHideAnimation]>
  <div fxFlex="100" class="padding-gap-large">
    <mat-card-header fxLayout="row" fxLayoutAlign="space-between center" class="modal-info-header">
      <div [fxFlex]="screenSize === screenSizeEnum.XS || screenSize === screenSizeEnum.SM ? '83' : '91'" fxLayoutAlign="start start" class="padding-gap-x-large"><span class="page-title">{{channel ? 'Channel Loop-out' : 'Loop-out'}}</span></div>
      <div [fxFlex]="screenSize === screenSizeEnum.XS || screenSize === screenSizeEnum.SM ? '17' : '9'" fxLayoutAlign="space-between end">
        <button tabindex="15" class="btn-close-x p-0" (click)="showInfo()" mat-button>?</button>
        <button tabindex="16" class="btn-close-x p-0" (click)="onClose()" mat-button>X</button>
      </div>
    </mat-card-header>
    <mat-card-content class="mt-5px">
      <div fxLayout="column">
        <div *ngIf="channel" class="padding-gap-large" fxLayout="column" fxLayout.gt-sm="row wrap" fxLayoutAlign="space-between stretch">
          <p fxFlex="40"><strong>Channel Peer:&nbsp;</strong>{{channel.remote_alias | titlecase}}</p>
          <p fxFlex="30"><strong>Channel ID:&nbsp;</strong>{{channel.chan_id}}</p>
          <p fxFlex="30"></p>
        </div>
        <mat-vertical-stepper [linear]="true" #stepper (selectionChange)="stepSelectionChanged($event)">
          <mat-step [stepControl]="inputFormGroup">
            <form [formGroup]="inputFormGroup" fxLayout="column" fxLayoutAlign="start" fxLayoutAlign.gt-sm="space-between" class="my-1">
              <ng-template matStepLabel>{{inputFormLabel}}</ng-template>
              <div fxLayout="column" fxFlex="100" fxLayoutAlign="space-between stretch">
                <rtl-loop-quote [quote]="minQuote" [termCaption]="'min'" [panelExpanded]="false" [showPanel]="true"></rtl-loop-quote>
                <rtl-loop-quote [quote]="maxQuote" [termCaption]="'max'" [panelExpanded]="false" [showPanel]="true"></rtl-loop-quote>
              </div>
              <div fxLayout="column" fxLayout.gt-sm="row wrap" fxFlex="100" fxLayoutAlign="space-between stretch" class="mt-1">              
                <mat-form-field fxFlex="48">
                  <input autoFocus matInput placeholder="Amount" type="number" step="1000" tabindex="1" formControlName="amount" required>
                  <mat-hint>Range: {{minQuote.amount | number}}-{{maxQuote.amount | number}}</mat-hint>
                  <span matSuffix>Sats</span>
                  <mat-error *ngIf="inputFormGroup.controls.amount.errors?.required">Amount is required.</mat-error>
                  <mat-error *ngIf="inputFormGroup.controls.amount.errors?.min">Amount must be greater than or equal to {{minQuote.amount | number}}.</mat-error>
                  <mat-error *ngIf="inputFormGroup.controls.amount.errors?.max">Amount must be less than or equal to {{maxQuote.amount | number}}.</mat-error>
                </mat-form-field>
                <mat-form-field fxFlex="48">
                  <input matInput placeholder="Target Confirmation Blocks" type="number" step="1" tabindex="2" formControlName="targetConf" required>
                  <mat-error *ngIf="inputFormGroup.controls.targetConf.errors?.required">Target confirmation blocks is required.</mat-error>
                  <mat-error *ngIf="inputFormGroup.controls.targetConf.errors?.min">Target confirmation blocks must be a positive number.</mat-error>
                </mat-form-field>
              </div>
              <div class="mt-2" fxLayout="row" fxLayoutAlign="start center" fxFlex="100">
                <button mat-stroked-button color="primary" tabindex="3" type="button" (click)="onEstimateQuote()" matStepperNext>Estimate Quote</button>
              </div>
            </form>
          </mat-step>
          <mat-step [stepControl]="quoteFormGroup">
            <form [formGroup]="quoteFormGroup" fxLayout="column" fxLayoutAlign="start" fxLayoutAlign.gt-sm="space-between" class="my-1">
              <ng-template matStepLabel>{{quoteFormLabel}}</ng-template>
              <rtl-loop-quote [quote]="quote" [showPanel]="false"></rtl-loop-quote>
              <div class="mt-2" fxLayout="row" fxLayoutAlign="start center" fxFlex="100">
                <button mat-stroked-button color="primary" tabindex="8" type="button" (click)="onLoopOut()" matStepperNext>Loop Out</button>
              </div>
            </form>
          </mat-step>
          <mat-step [stepControl]="statusFormGroup">
            <form [formGroup]="statusFormGroup" fxLayout="column" fxLayoutAlign="start" fxLayoutAlign.gt-sm="space-between" class="my-1">
              <ng-template matStepLabel>Loop-Out</ng-template>
              <div fxLayout="row wrap" fxFlex="100" fxLayoutAlign="space-between stretch">
                <mat-progress-bar fxFlex="100" *ngIf="!loopOutStatus" color="primary" mode="indeterminate"></mat-progress-bar>
                <mat-expansion-panel class="flat-expansion-panel" fxFlex="100" [expanded]="true">
                  <mat-expansion-panel-header>
                    <mat-panel-title>
                      <span fxLayoutAlign="start center" fxFlex="100">{{!loopOutStatus ? 'Waiting for Loop-out request...' : loopOutStatus.id_bytes ? 'Loop-out request details' : 'Loop-out error details'}}<mat-icon *ngIf="loopOutStatus" class="ml-1 icon-small">{{(loopOutStatus && loopOutStatus?.id_bytes) ? 'check' : 'close'}}</mat-icon></span>
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  <div  *ngIf="!loopOutStatus; else loopOutStatusBlock"></div>
                </mat-expansion-panel>
              </div>
              <h4 *ngIf="loopOutStatus" fxLayoutAlign="start" class="font-bold-500 mt-2">{{(loopOutStatus && loopOutStatus.error) ? 'Loop-out failed.' : (loopOutStatus && loopOutStatus.id_bytes && channel) ? 'Loop-out request placed successfully. Go to loop to check it\'s status.' : 'Loop-out request placed successfully.'}}</h4>
              <div class="mt-2" fxLayout="row" fxLayoutAlign="start center" fxFlex="100">
                <button *ngIf="loopOutStatus && loopOutStatus.id_bytes && channel" mat-flat-button color="primary" tabindex="10" type="button" (click)="goToLoop()">Check Status</button>
                <button *ngIf="loopOutStatus && (loopOutStatus.error || !loopOutStatus.id_bytes)" mat-flat-button color="primary" tabindex="12" type="button" (click)="stepper.reset()">Start Again</button>
              </div>
            </form>
          </mat-step>
        </mat-vertical-stepper>
        <div fxLayout="row" fxFlex="100" fxLayoutAlign="end center">        
          <button mat-stroked-button color="primary" tabindex="13" type="button" [mat-dialog-close]="false" default>Close</button>
        </div>
      </div>
    </mat-card-content>
  </div>
</div>
<ng-template #loopOutStatusBlock>
  <rtl-loop-status fxLayout="column" [loopStatus]="loopOutStatus"></rtl-loop-status>
</ng-template>

<div fxLayout="column" fxFlex="100" fxLayoutAlign="start stretch" *ngIf="flgShowInfo" [@showHideAnimation] style="height: 51rem;">
  <div fxLayout="column" fxFlex="100" fxLayoutAlign="space-between stretch" class="padding-gap-large">
    <mat-card-header fxLayout="row" fxLayoutAlign="space-between center" class="modal-info-header">
      <div fxFlex="95" fxLayoutAlign="start start" class="padding-gap-x-large"><span class="page-title"></span></div>
      <div fxFlex="8" fxLayoutAlign="end center">
        <button tabindex="17" class="btn-close-x p-0" (click)="flgShowInfo=false;" mat-button>X</button>
      </div>
    </mat-card-header>
    <mat-card-content fxLayout="column" fxFlex="80" fxLayoutAlign="space-between center">
      <!-- <?xml version="1.0" encoding="UTF-8"?> -->
      <svg viewBox="0 0 108 118" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <!-- Generator: Sketch 63.1 (92452) - https://sketch.com -->
          <title>Loop_Step01</title>
          <desc>Created with Sketch.</desc>
          <g id="Loopv0.2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
              <g id="3.1_LoopPage_LoopOut_Flow01" transform="translate(-594.000000, -215.000000)" fill-rule="nonzero">
                  <g id="Loop_Step01" transform="translate(594.000000, 215.000000)">
                      <g id="Group-16" transform="translate(23.000000, 0.000000)">
                          <circle id="Oval" fill="#F1F1F1" cx="42.4877419" cy="42.4877419" r="42.4877419"></circle>
                          <path d="M56.0827415,28.5000036 C60.4468211,28.5000036 63.9999285,25.1343958 63.9999285,21.0000215 C63.9999285,16.8656472 60.4468211,13.5000393 56.0827415,13.5000393 C52.9843297,13.5000393 50.5608889,15.4359631 48.9999642,17.1843872 C47.4390396,15.4359631 45.0155987,13.5000393 41.9171869,13.5000393 C37.5531074,13.5000393 34,16.8656472 34,21.0000215 C34,25.1343958 37.5531074,28.5000036 41.9171869,28.5000036 C45.0155987,28.5000036 47.4390396,26.5640798 48.9999642,24.8156557 C50.5608889,26.5640798 52.9843297,28.5000036 56.0827415,28.5000036 Z M41.9171869,24.0000143 C40.0328073,24.0000143 38.4999893,22.6546959 38.4999893,21.0000286 C38.4999893,19.3453471 40.0328073,18.0000286 41.9171869,18.0000286 C43.707771,18.0000286 45.3577763,19.6921938 46.3234264,21.0000286 C45.3671604,22.2937501 43.7031019,24.0000143 41.9171869,24.0000143 Z M56.0827415,24.0000143 C54.2921574,24.0000143 52.6421522,22.3078492 51.676502,21.0000286 C52.6327681,19.7062929 54.2968266,18.0000286 56.0827415,18.0000286 C57.9671212,18.0000286 59.4999392,19.3453471 59.4999392,21.0000286 C59.4999392,22.6546959 57.9671212,24.0000143 56.0827415,24.0000143 Z" id="i" class="svg-fill-primary"></path>
                      </g>
                      <g id="Group-21" transform="translate(0.000000, 36.000000)">
                          <ellipse id="Oval" fill="#CBCBCB" cx="48.644129" cy="75.1589677" rx="48.644129" ry="6.61766437"></ellipse>
                          <ellipse id="Oval" fill="#000000" opacity="0.1" cx="48.644129" cy="75.1589677" rx="40.8402581" ry="5.55600756"></ellipse>
                          <rect id="Rectangle" fill="#6F6F6F" x="25.2325161" y="6.09470968" width="54.1068387" height="62.9512258"></rect>
                          <rect id="Rectangle" fill="#4A4A4A" x="20" y="1.24344979e-14" width="65.0322581" height="22.3710968"></rect>
                          <rect id="Rectangle" fill="#4A4A4A" x="20" y="26" width="65.0322581" height="22.3710968"></rect>
                          <rect id="Rectangle" fill="#4A4A4A" x="19.7698065" y="52.9179355" width="65.0322581" height="22.3710968"></rect>
                          <rect id="Rectangle" fill="#6ECB48" x="67.6335484" y="3.75354839" width="4.16206452" height="4.16206452"></rect>
                          <rect id="Rectangle" fill="#6ECB48" x="73.6165161" y="3.75354839" width="4.16206452" height="4.16206452"></rect>
                          <rect id="Rectangle" fill="#6ECB48" x="79.5994839" y="3.75354839" width="4.16206452" height="4.16206452"></rect>
                          <rect id="Rectangle" fill="#6ECB48" x="67.6335484" y="30.0265806" width="4.16206452" height="4.16206452"></rect>
                          <rect id="Rectangle" fill="#6ECB48" x="73.6165161" y="30.0265806" width="4.16206452" height="4.16206452"></rect>
                          <rect id="Rectangle" fill="#6ECB48" x="79.5994839" y="30.0265806" width="4.16206452" height="4.16206452"></rect>
                          <rect id="Rectangle" fill="#6ECB48" x="67.6335484" y="56.2996129" width="4.16206452" height="4.16206452"></rect>
                          <rect id="Rectangle" fill="#6ECB48" x="73.6165161" y="56.2996129" width="4.16206452" height="4.16206452"></rect>
                          <rect id="Rectangle" fill="#6ECB48" x="79.5994839" y="56.2996129" width="4.16206452" height="4.16206452"></rect>
                      </g>
                  </g>
              </g>
          </g>
      </svg>      
      <!-- <img src="assets/images/loop/Loop_Step01.svg" alt="Loop Step 1" style="width:20rem;"> -->
      <div class="mt-4" fxLayout="column" [fxFlex]="screenSize === screenSizeEnum.XS || screenSize === screenSizeEnum.SM ? '40' : '30'" fxLayoutAlign="start center">
        <mat-card-title>Loop-out, Explained.</mat-card-title>
        <mat-card-subtitle fxLayout="row" fxLayoutAlign="center start">
          <p style="font-size: 120%;" fxFlex="80">Lightning loop is non custodial service offered by lightning labs to bridge on-chain and off-chain bitcoin using submarine swaps.</p>
        </mat-card-subtitle>
      </div>
      <div class="mt-2" fxLayout="row" fxFlex="5" fxLayoutAlign="center start">
        <span class="dot tiny-dot dot-primary"></span>
        <span class="dot tiny-dot dot-primary-lighter"></span>
        <span class="dot tiny-dot dot-primary-lighter"></span>
        <span class="dot tiny-dot dot-primary-lighter"></span>
        <span class="dot tiny-dot dot-primary-lighter"></span>
      </div>
    </mat-card-content>
    <div fxLayout="row" fxFlex="100" fxLayoutAlign="end end">        
      <button mat-stroked-button class="mr-1" color="primary" tabindex="13" type="button" (click)="flgShowInfo=false;">Close</button>
      <button mat-flat-button color="primary" tabindex="14" type="button">Next</button>
    </div>
  </div>
</div>